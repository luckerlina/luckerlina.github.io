var nums=new Array,score=0,hasConflicted=new Array,startx=0,starty=0,endx=0,endy=0;function newgame(){documentWidth>500?(containerWidth=500,cellWidth=100,cellSpace=20):settingForMobile(),init(),generateOneNumber(),generateOneNumber()}function settingForMobile(){$("#header .wrapper").css("width",containerWidth),$("#grid-container").css("width",containerWidth-2*cellSpace),$("#grid-container").css("height",containerWidth-2*cellSpace),$("#grid-container").css("padding",cellSpace),$("#grid-container").css("border-radius",.02*containerWidth),$(".grid-cell").css("width",cellWidth),$(".grid-cell").css("height",cellWidth),$(".grid-cell").css("border-radius",.06*cellWidth)}function init(){for(var e=0;e<4;e++)for(var n=0;n<4;n++){var o=$("#grid-cell-"+e+"-"+n);o.css("top",getPosTop(e,n)),o.css("left",getPosLeft(e,n))}for(e=0;e<4;e++){nums[e]=new Array,hasConflicted[e]=new Array;for(n=0;n<4;n++)nums[e][n]=0,hasConflicted[e][n]=!1}updateView(),score=0,updateScore(score)}function updateView(){$(".number-cell").remove();for(var e=0;e<4;e++)for(var n=0;n<4;n++){$("#grid-container").append('<div class="number-cell" id="number-cell-'+e+"-"+n+'"></div>');var o=$("#number-cell-"+e+"-"+n);0==nums[e][n]?(o.css("width","0px"),o.css("height","0px"),o.css("top",getPosTop(e,n)+.5*cellWidth),o.css("left",getPosLeft(e,n)+.5*cellWidth)):(o.css("width",cellWidth),o.css("height",cellWidth),o.css("top",getPosTop(e,n)),o.css("left",getPosLeft(e,n)),o.css("background-color",getNumberBackgroundColor(nums[e][n])),o.css("color",getNumberColor(nums[e][n])),o.text(nums[e][n])),hasConflicted[e][n]=!1,$(".number-cell").css("border-radius",.06*cellWidth),$(".number-cell").css("font-size",.5*cellWidth),$(".number-cell").css("line-height",cellWidth+"px")}}function generateOneNumber(){if(!nospace(nums)){for(var e=0,n=new Array,o=0;o<4;o++)for(var t=0;t<4;t++)0==nums[o][t]&&(n[e]=4*o+t,e++);var s=Math.floor(Math.random()*e),r=Math.floor(n[s]/4),a=Math.floor(n[s]%4),i=Math.random()<.5?2:4;nums[r][a]=i,showNumberWihthAnimation(r,a,i)}}function moveLeft(){for(var e=0;e<4;e++)for(var n=0;n<4;n++)if(0!=nums[e][n])for(var o=0;o<n;o++){if(0==nums[e][o]&&noBlockHorizontal(e,o,n,nums)){showMoveAnimation(e,n,e,o),nums[e][o]=nums[e][n],nums[e][n]=0;break}if(nums[e][o]==nums[e][n]&&noBlockHorizontal(e,o,n,nums)&&!hasConflicted[e][o]){showMoveAnimation(e,n,e,o),nums[e][o]+=nums[e][n],nums[e][n]=0,score+=nums[e][o],updateScore(score),hasConflicted[e][o]=!0;break}}setTimeout(updateView,200)}function moveUp(){for(var e=0;e<4;e++)for(var n=1;n<4;n++)if(0!=nums[n][e])for(var o=0;o<n;o++){if(0==nums[o][e]&&noBlockVertical(e,o,n,nums)){showMoveAnimation(n,e,o,e),nums[o][e]=nums[n][e],nums[n][e]=0;break}if(nums[o][e]==nums[n][e]&&noBlockVertical(e,o,n,nums)&&!hasConflicted[o][e]){showMoveAnimation(n,e,o,e),nums[o][e]+=nums[n][e],nums[n][e]=0,score+=nums[o][e],updateScore(score),hasConflicted[o][e]=!0;break}}setTimeout(updateView,200)}function moveRight(){for(var e=0;e<4;e++)for(var n=2;n>=0;n--)if(0!=nums[e][n])for(var o=3;o>n;o--){if(0==nums[e][o]&&noBlockHorizontal(e,n,o,nums)){showMoveAnimation(e,n,e,o),nums[e][o]=nums[e][n],nums[e][n]=0;break}if(nums[e][o]==nums[e][n]&&noBlockHorizontal(e,n,o,nums)&&!hasConflicted[e][o]){showMoveAnimation(e,n,e,o),nums[e][o]+=nums[e][n],nums[e][n]=0,score+=nums[e][o],updateScore(score),hasConflicted[e][o]=!0;break}}setTimeout(updateView,200)}function moveDown(){for(var e=0;e<4;e++)for(var n=2;n>=0;n--)if(0!=nums[n][e])for(var o=3;o>n;o--){if(0==nums[o][e]&&noBlockVertical(e,n,o,nums)){showMoveAnimation(n,e,o,e),nums[o][e]=nums[n][e],nums[n][e]=0;break}if(nums[o][e]==nums[n][e]&&noBlockVertical(e,n,o,nums)&&!hasConflicted[o][e]){showMoveAnimation(n,e,o,e),nums[o][e]+=nums[n][e],nums[n][e]=0,score+=nums[o][e],updateScore(score),hasConflicted[o][e]=!0;break}}setTimeout(updateView,200)}$(document).ready((function(){newgame()})),$(document).keydown((function(e){switch(e.preventDefault(),e.keyCode){case 37:canMoveLeft(nums)&&(moveLeft(),setTimeout(generateOneNumber,200),setTimeout(IsGameOver,500));break;case 38:canMoveUp(nums)&&(moveUp(),setTimeout(generateOneNumber,200),setTimeout(IsGameOver,500));break;case 39:canMoveRight(nums)&&(moveRight(),setTimeout(generateOneNumber,200),setTimeout(IsGameOver,500));break;case 40:canMoveDown(nums)&&(moveDown(),setTimeout(generateOneNumber,200),setTimeout(IsGameOver,500))}})),document.addEventListener("touchstart",(function(e){startx=e.touches[0].pageX,starty=e.touches[0].pageY})),document.addEventListener("touchend",(function(e){endx=e.changedTouches[0].pageX,endy=e.changedTouches[0].pageY;var n=endx-startx,o=endy-starty;Math.abs(n)<.08*documentWidth&&Math.abs(o)<.08*documentWidth||(Math.abs(n)>=Math.abs(o)?n>0?canMoveRight(nums)&&(moveRight(),setTimeout(generateOneNumber,200),setTimeout(IsGameOver,500)):canMoveLeft(nums)&&(moveLeft(),setTimeout(generateOneNumber,200),setTimeout(IsGameOver,500)):o>0?canMoveDown(nums)&&(moveDown(),setTimeout(generateOneNumber,200),setTimeout(IsGameOver,500)):canMoveUp(nums)&&(moveUp(),setTimeout(generateOneNumber,200),setTimeout(IsGameOver,500)))}));