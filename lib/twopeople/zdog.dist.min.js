/*!
 * Zdog v1.1.1
 * Round, flat, designer-friendly pseudo-3D engine
 * Licensed MIT
 * https://zzz.dog
 * Copyright 2019 Metafizzy
 */
!function(root,factory){"object"==typeof module&&module.exports?module.exports=factory():root.Zdog=factory()}(this,(function factory(){var Zdog={};Zdog.TAU=2*Math.PI,Zdog.extend=function(a,b){for(var prop in b)a[prop]=b[prop];return a},Zdog.lerp=function(a,b,alpha){return(b-a)*alpha+a},Zdog.modulo=function(num,div){return(num%div+div)%div};var powerMultipliers={2:function(a){return a*a},3:function(a){return a*a*a},4:function(a){return a*a*a*a},5:function(a){return a*a*a*a*a}};return Zdog.easeInOut=function(alpha,power){if(1==power)return alpha;var isFirstHalf=(alpha=Math.max(0,Math.min(1,alpha)))<.5,slope=isFirstHalf?alpha:1-alpha,powerMultiplier,curve=(powerMultipliers[power]||powerMultipliers[2])(slope/=.5);return curve/=2,isFirstHalf?curve:1-curve},Zdog})),function(root,factory){"object"==typeof module&&module.exports?module.exports=factory():root.Zdog.CanvasRenderer=factory()}(this,(function factory(){var CanvasRenderer={isCanvas:!0,begin:function(ctx){ctx.beginPath()},move:function(ctx,elem,point){ctx.moveTo(point.x,point.y)},line:function(ctx,elem,point){ctx.lineTo(point.x,point.y)},bezier:function(ctx,elem,cp0,cp1,end){ctx.bezierCurveTo(cp0.x,cp0.y,cp1.x,cp1.y,end.x,end.y)},closePath:function(ctx){ctx.closePath()},setPath:function(){},renderPath:function(ctx,elem,pathCommands,isClosed){this.begin(ctx,elem),pathCommands.forEach((function(command){command.render(ctx,elem,CanvasRenderer)})),isClosed&&this.closePath(ctx,elem)},stroke:function(ctx,elem,isStroke,color,lineWidth){isStroke&&(ctx.strokeStyle=color,ctx.lineWidth=lineWidth,ctx.stroke())},fill:function(ctx,elem,isFill,color){isFill&&(ctx.fillStyle=color,ctx.fill())},end:function(){}};return CanvasRenderer})),function(root,factory){"object"==typeof module&&module.exports?module.exports=factory():root.Zdog.SvgRenderer=factory()}(this,(function factory(){var SvgRenderer={isSvg:!0},round=SvgRenderer.round=function(num){return Math.round(1e3*num)/1e3};function getPointString(point){return round(point.x)+","+round(point.y)+" "}return SvgRenderer.begin=function(){},SvgRenderer.move=function(svg,elem,point){return"M"+getPointString(point)},SvgRenderer.line=function(svg,elem,point){return"L"+getPointString(point)},SvgRenderer.bezier=function(svg,elem,cp0,cp1,end){return"C"+getPointString(cp0)+getPointString(cp1)+getPointString(end)},SvgRenderer.closePath=function(){return"Z"},SvgRenderer.setPath=function(svg,elem,pathValue){elem.setAttribute("d",pathValue)},SvgRenderer.renderPath=function(svg,elem,pathCommands,isClosed){var pathValue="";pathCommands.forEach((function(command){pathValue+=command.render(svg,elem,SvgRenderer)})),isClosed&&(pathValue+=this.closePath(svg,elem)),this.setPath(svg,elem,pathValue)},SvgRenderer.stroke=function(svg,elem,isStroke,color,lineWidth){isStroke&&(elem.setAttribute("stroke",color),elem.setAttribute("stroke-width",lineWidth))},SvgRenderer.fill=function(svg,elem,isFill,color){var fillColor=isFill?color:"none";elem.setAttribute("fill",fillColor)},SvgRenderer.end=function(svg,elem){svg.appendChild(elem)},SvgRenderer})),function(root,factory){if("object"==typeof module&&module.exports)module.exports=factory(require("./boilerplate"));else{var Zdog=root.Zdog;Zdog.Vector=factory(Zdog)}}(this,(function factory(utils){function Vector(position){this.set(position)}var TAU=utils.TAU;function rotateProperty(vec,angle,propA,propB){if(angle&&angle%TAU!=0){var cos=Math.cos(angle),sin=Math.sin(angle),a=vec[propA],b=vec[propB];vec[propA]=a*cos-b*sin,vec[propB]=b*cos+a*sin}}function getMagnitudeSqrt(sum){return Math.abs(sum-1)<1e-8?1:Math.sqrt(sum)}return Vector.prototype.set=function(pos){return this.x=pos&&pos.x||0,this.y=pos&&pos.y||0,this.z=pos&&pos.z||0,this},Vector.prototype.write=function(pos){return pos?(this.x=null!=pos.x?pos.x:this.x,this.y=null!=pos.y?pos.y:this.y,this.z=null!=pos.z?pos.z:this.z,this):this},Vector.prototype.rotate=function(rotation){if(rotation)return this.rotateZ(rotation.z),this.rotateY(rotation.y),this.rotateX(rotation.x),this},Vector.prototype.rotateZ=function(angle){rotateProperty(this,angle,"x","y")},Vector.prototype.rotateX=function(angle){rotateProperty(this,angle,"y","z")},Vector.prototype.rotateY=function(angle){rotateProperty(this,angle,"x","z")},Vector.prototype.isSame=function(pos){return!!pos&&(this.x===pos.x&&this.y===pos.y&&this.z===pos.z)},Vector.prototype.add=function(pos){return pos?(this.x+=pos.x||0,this.y+=pos.y||0,this.z+=pos.z||0,this):this},Vector.prototype.subtract=function(pos){return pos?(this.x-=pos.x||0,this.y-=pos.y||0,this.z-=pos.z||0,this):this},Vector.prototype.multiply=function(pos){return null==pos?this:("number"==typeof pos?(this.x*=pos,this.y*=pos,this.z*=pos):(this.x*=null!=pos.x?pos.x:1,this.y*=null!=pos.y?pos.y:1,this.z*=null!=pos.z?pos.z:1),this)},Vector.prototype.transform=function(translation,rotation,scale){return this.multiply(scale),this.rotate(rotation),this.add(translation),this},Vector.prototype.lerp=function(pos,alpha){return this.x=utils.lerp(this.x,pos.x||0,alpha),this.y=utils.lerp(this.y,pos.y||0,alpha),this.z=utils.lerp(this.z,pos.z||0,alpha),this},Vector.prototype.magnitude=function(){var sum;return getMagnitudeSqrt(this.x*this.x+this.y*this.y+this.z*this.z)},Vector.prototype.magnitude2d=function(){var sum;return getMagnitudeSqrt(this.x*this.x+this.y*this.y)},Vector.prototype.copy=function(){return new Vector(this)},Vector})),function(root,factory){if("object"==typeof module&&module.exports)module.exports=factory(require("./boilerplate"),require("./vector"),require("./canvas-renderer"),require("./svg-renderer"));else{var Zdog=root.Zdog;Zdog.Anchor=factory(Zdog,Zdog.Vector,Zdog.CanvasRenderer,Zdog.SvgRenderer)}}(this,(function factory(utils,Vector,CanvasRenderer,SvgRenderer){var TAU=utils.TAU,onePoint={x:1,y:1,z:1};function Anchor(options){this.create(options||{})}function getSubclass(Super){return function(defaults){function Item(options){this.create(options||{})}return Item.prototype=Object.create(Super.prototype),Item.prototype.constructor=Item,Item.defaults=utils.extend({},Super.defaults),utils.extend(Item.defaults,defaults),Item.optionKeys=Super.optionKeys.slice(0),Object.keys(Item.defaults).forEach((function(key){1!=!Item.optionKeys.indexOf(key)&&Item.optionKeys.push(key)})),Item.subclass=getSubclass(Item),Item}}return Anchor.prototype.create=function(options){this.children=[],utils.extend(this,this.constructor.defaults),this.setOptions(options),this.translate=new Vector(options.translate),this.rotate=new Vector(options.rotate),this.scale=new Vector(onePoint).multiply(this.scale),this.origin=new Vector,this.renderOrigin=new Vector,this.addTo&&this.addTo.addChild(this)},Anchor.defaults={},Anchor.optionKeys=Object.keys(Anchor.defaults).concat(["rotate","translate","scale","addTo"]),Anchor.prototype.setOptions=function(options){var optionKeys=this.constructor.optionKeys;for(var key in options)-1!=optionKeys.indexOf(key)&&(this[key]=options[key])},Anchor.prototype.addChild=function(shape){-1==this.children.indexOf(shape)&&(shape.remove(),shape.addTo=this,this.children.push(shape))},Anchor.prototype.removeChild=function(shape){var index=this.children.indexOf(shape);-1!=index&&this.children.splice(index,1)},Anchor.prototype.remove=function(){this.addTo&&this.addTo.removeChild(this)},Anchor.prototype.update=function(){this.reset(),this.children.forEach((function(child){child.update()})),this.transform(this.translate,this.rotate,this.scale)},Anchor.prototype.reset=function(){this.renderOrigin.set(this.origin)},Anchor.prototype.transform=function(translation,rotation,scale){this.renderOrigin.transform(translation,rotation,scale),this.children.forEach((function(child){child.transform(translation,rotation,scale)}))},Anchor.prototype.updateGraph=function(){this.update(),this.updateFlatGraph(),this.flatGraph.forEach((function(item){item.updateSortValue()})),this.flatGraph.sort(Anchor.shapeSorter)},Anchor.shapeSorter=function(a,b){return a.sortValue-b.sortValue},Object.defineProperty(Anchor.prototype,"flatGraph",{get:function(){return this._flatGraph||this.updateFlatGraph(),this._flatGraph},set:function(graph){this._flatGraph=graph}}),Anchor.prototype.updateFlatGraph=function(){this.flatGraph=this.getFlatGraph()},Anchor.prototype.getFlatGraph=function(){var flatGraph=[this];return this.addChildFlatGraph(flatGraph)},Anchor.prototype.addChildFlatGraph=function(flatGraph){return this.children.forEach((function(child){var childFlatGraph=child.getFlatGraph();Array.prototype.push.apply(flatGraph,childFlatGraph)})),flatGraph},Anchor.prototype.updateSortValue=function(){this.sortValue=this.renderOrigin.z},Anchor.prototype.render=function(){},Anchor.prototype.renderGraphCanvas=function(ctx){if(!ctx)throw new Error("ctx is "+ctx+". Canvas context required for render. Check .renderGraphCanvas( ctx ).");this.flatGraph.forEach((function(item){item.render(ctx,CanvasRenderer)}))},Anchor.prototype.renderGraphSvg=function(svg){if(!svg)throw new Error("svg is "+svg+". SVG required for render. Check .renderGraphSvg( svg ).");this.flatGraph.forEach((function(item){item.render(svg,SvgRenderer)}))},Anchor.prototype.copy=function(options){var itemOptions={},optionKeys,ItemClass;return this.constructor.optionKeys.forEach((function(key){itemOptions[key]=this[key]}),this),utils.extend(itemOptions,options),new(0,this.constructor)(itemOptions)},Anchor.prototype.copyGraph=function(options){var clone=this.copy(options);return this.children.forEach((function(child){child.copyGraph({addTo:clone})})),clone},Anchor.prototype.normalizeRotate=function(){this.rotate.x=utils.modulo(this.rotate.x,TAU),this.rotate.y=utils.modulo(this.rotate.y,TAU),this.rotate.z=utils.modulo(this.rotate.z,TAU)},Anchor.subclass=getSubclass(Anchor),Anchor})),function(root,factory){"object"==typeof module&&module.exports?module.exports=factory():root.Zdog.Dragger=factory()}(this,(function factory(){var hasWindow="undefined"!=typeof window,downEvent="mousedown",moveEvent="mousemove",upEvent="mouseup";function noop(){}function Dragger(options){this.create(options||{})}return hasWindow&&(window.PointerEvent?(downEvent="pointerdown",moveEvent="pointermove",upEvent="pointerup"):"ontouchstart"in window&&(downEvent="touchstart",moveEvent="touchmove",upEvent="touchend")),Dragger.prototype.create=function(options){this.onDragStart=options.onDragStart||noop,this.onDragMove=options.onDragMove||noop,this.onDragEnd=options.onDragEnd||noop,this.bindDrag(options.startElement)},Dragger.prototype.bindDrag=function(element){(element=this.getQueryElement(element))&&(element.style.touchAction="none",element.addEventListener(downEvent,this))},Dragger.prototype.getQueryElement=function(element){return"string"==typeof element&&(element=document.querySelector(element)),element},Dragger.prototype.handleEvent=function(event){var method=this["on"+event.type];method&&method.call(this,event)},Dragger.prototype.onmousedown=Dragger.prototype.onpointerdown=function(event){this.dragStart(event,event)},Dragger.prototype.ontouchstart=function(event){this.dragStart(event,event.changedTouches[0])},Dragger.prototype.dragStart=function(event,pointer){event.preventDefault(),this.dragStartX=pointer.pageX,this.dragStartY=pointer.pageY,hasWindow&&(window.addEventListener(moveEvent,this),window.addEventListener(upEvent,this)),this.onDragStart(pointer)},Dragger.prototype.ontouchmove=function(event){this.dragMove(event,event.changedTouches[0])},Dragger.prototype.onmousemove=Dragger.prototype.onpointermove=function(event){this.dragMove(event,event)},Dragger.prototype.dragMove=function(event,pointer){event.preventDefault();var moveX=pointer.pageX-this.dragStartX,moveY=pointer.pageY-this.dragStartY;this.onDragMove(pointer,moveX,moveY)},Dragger.prototype.onmouseup=Dragger.prototype.onpointerup=Dragger.prototype.ontouchend=Dragger.prototype.dragEnd=function(){window.removeEventListener(moveEvent,this),window.removeEventListener(upEvent,this),this.onDragEnd()},Dragger})),function(root,factory){if("object"==typeof module&&module.exports)module.exports=factory(require("./boilerplate"),require("./anchor"),require("./dragger"));else{var Zdog=root.Zdog;Zdog.Illustration=factory(Zdog,Zdog.Anchor,Zdog.Dragger)}}(this,(function factory(utils,Anchor,Dragger){function noop(){}var TAU=utils.TAU,Illustration=Anchor.subclass({element:void 0,centered:!0,zoom:1,dragRotate:!1,resize:!1,onPrerender:noop,onDragStart:noop,onDragMove:noop,onDragEnd:noop,onResize:noop});function empty(element){for(;element.firstChild;)element.removeChild(element.firstChild)}return utils.extend(Illustration.prototype,Dragger.prototype),Illustration.prototype.create=function(options){Anchor.prototype.create.call(this,options),Dragger.prototype.create.call(this,options),this.setElement(this.element),this.setDragRotate(this.dragRotate),this.setResize(this.resize)},Illustration.prototype.setElement=function(element){if(!(element=this.getQueryElement(element)))throw new Error("Zdog.Illustration element required. Set to "+element);var nodeName=element.nodeName.toLowerCase();"canvas"==nodeName?this.setCanvas(element):"svg"==nodeName&&this.setSvg(element)},Illustration.prototype.setSize=function(width,height){width=Math.round(width),height=Math.round(height),this.isCanvas?this.setSizeCanvas(width,height):this.isSvg&&this.setSizeSvg(width,height)},Illustration.prototype.setResize=function(resize){this.resize=resize,this.resizeListener||(this.resizeListener=this.onWindowResize.bind(this)),resize?(window.addEventListener("resize",this.resizeListener),this.onWindowResize()):window.removeEventListener("resize",this.resizeListener)},Illustration.prototype.onWindowResize=function(){this.setMeasuredSize(),this.onResize(this.width,this.height)},Illustration.prototype.setMeasuredSize=function(){var width,height,isFullscreen;if("fullscreen"==this.resize)width=window.innerWidth,height=window.innerHeight;else{var rect=this.element.getBoundingClientRect();width=rect.width,height=rect.height}this.setSize(width,height)},Illustration.prototype.renderGraph=function(item){this.isCanvas?this.renderGraphCanvas(item):this.isSvg&&this.renderGraphSvg(item)},Illustration.prototype.updateRenderGraph=function(item){this.updateGraph(),this.renderGraph(item)},Illustration.prototype.setCanvas=function(element){this.element=element,this.isCanvas=!0,this.ctx=this.element.getContext("2d"),this.setSizeCanvas(element.width,element.height)},Illustration.prototype.setSizeCanvas=function(width,height){this.width=width,this.height=height;var pixelRatio=this.pixelRatio=window.devicePixelRatio||1,needsHighPixelRatioSizing;this.element.width=this.canvasWidth=width*pixelRatio,this.element.height=this.canvasHeight=height*pixelRatio,pixelRatio>1&&!this.resize&&(this.element.style.width=width+"px",this.element.style.height=height+"px")},Illustration.prototype.renderGraphCanvas=function(item){item=item||this,this.prerenderCanvas(),Anchor.prototype.renderGraphCanvas.call(item,this.ctx),this.postrenderCanvas()},Illustration.prototype.prerenderCanvas=function(){var ctx=this.ctx;if(ctx.lineCap="round",ctx.lineJoin="round",ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight),ctx.save(),this.centered){var centerX=this.width/2*this.pixelRatio,centerY=this.height/2*this.pixelRatio;ctx.translate(centerX,centerY)}var scale=this.pixelRatio*this.zoom;ctx.scale(scale,scale),this.onPrerender(ctx)},Illustration.prototype.postrenderCanvas=function(){this.ctx.restore()},Illustration.prototype.setSvg=function(element){this.element=element,this.isSvg=!0,this.pixelRatio=1;var width=element.getAttribute("width"),height=element.getAttribute("height");this.setSizeSvg(width,height)},Illustration.prototype.setSizeSvg=function(width,height){this.width=width,this.height=height;var viewWidth=width/this.zoom,viewHeight=height/this.zoom,viewX=this.centered?-viewWidth/2:0,viewY=this.centered?-viewHeight/2:0;this.element.setAttribute("viewBox",viewX+" "+viewY+" "+viewWidth+" "+viewHeight),this.resize?(this.element.removeAttribute("width"),this.element.removeAttribute("height")):(this.element.setAttribute("width",width),this.element.setAttribute("height",height))},Illustration.prototype.renderGraphSvg=function(item){item=item||this,empty(this.element),this.onPrerender(this.element),Anchor.prototype.renderGraphSvg.call(item,this.element)},Illustration.prototype.setDragRotate=function(item){item&&(!0===item&&(item=this),this.dragRotate=item,this.bindDrag(this.element))},Illustration.prototype.dragStart=function(){this.dragStartRX=this.dragRotate.rotate.x,this.dragStartRY=this.dragRotate.rotate.y,Dragger.prototype.dragStart.apply(this,arguments)},Illustration.prototype.dragMove=function(event,pointer){var moveX=pointer.pageX-this.dragStartX,moveY=pointer.pageY-this.dragStartY,displaySize=Math.min(this.width,this.height),moveRY=moveX/displaySize*TAU,moveRX=moveY/displaySize*TAU;this.dragRotate.rotate.x=this.dragStartRX-moveRX,this.dragRotate.rotate.y=this.dragStartRY-moveRY,Dragger.prototype.dragMove.apply(this,arguments)},Illustration})),function(root,factory){if("object"==typeof module&&module.exports)module.exports=factory(require("./vector"));else{var Zdog=root.Zdog;Zdog.PathCommand=factory(Zdog.Vector)}}(this,(function factory(Vector){function PathCommand(method,points,previousPoint){this.method=method,this.points=points.map(mapVectorPoint),this.renderPoints=points.map(mapNewVector),this.previousPoint=previousPoint,this.endRenderPoint=this.renderPoints[this.renderPoints.length-1],"arc"==method&&(this.controlPoints=[new Vector,new Vector])}function mapVectorPoint(point){return point instanceof Vector?point:new Vector(point)}function mapNewVector(point){return new Vector(point)}PathCommand.prototype.reset=function(){var points=this.points;this.renderPoints.forEach((function(renderPoint,i){var point=points[i];renderPoint.set(point)}))},PathCommand.prototype.transform=function(translation,rotation,scale){this.renderPoints.forEach((function(renderPoint){renderPoint.transform(translation,rotation,scale)}))},PathCommand.prototype.render=function(ctx,elem,renderer){return this[this.method](ctx,elem,renderer)},PathCommand.prototype.move=function(ctx,elem,renderer){return renderer.move(ctx,elem,this.renderPoints[0])},PathCommand.prototype.line=function(ctx,elem,renderer){return renderer.line(ctx,elem,this.renderPoints[0])},PathCommand.prototype.bezier=function(ctx,elem,renderer){var cp0=this.renderPoints[0],cp1=this.renderPoints[1],end=this.renderPoints[2];return renderer.bezier(ctx,elem,cp0,cp1,end)};var arcHandleLength=9/16;return PathCommand.prototype.arc=function(ctx,elem,renderer){var prev=this.previousPoint,corner=this.renderPoints[0],end=this.renderPoints[1],cp0=this.controlPoints[0],cp1=this.controlPoints[1];return cp0.set(prev).lerp(corner,9/16),cp1.set(end).lerp(corner,9/16),renderer.bezier(ctx,elem,cp0,cp1,end)},PathCommand})),function(root,factory){if("object"==typeof module&&module.exports)module.exports=factory(require("./boilerplate"),require("./vector"),require("./path-command"),require("./anchor"));else{var Zdog=root.Zdog;Zdog.Shape=factory(Zdog,Zdog.Vector,Zdog.PathCommand,Zdog.Anchor)}}(this,(function factory(utils,Vector,PathCommand,Anchor){var Shape=Anchor.subclass({stroke:1,fill:!1,color:"#333",closed:!0,visible:!0,path:[{}],front:{z:1},backface:!0});Shape.prototype.create=function(options){Anchor.prototype.create.call(this,options),this.updatePath(),this.front=new Vector(options.front||this.front),this.renderFront=new Vector(this.front),this.renderNormal=new Vector};var actionNames=["move","line","bezier","arc"];Shape.prototype.updatePath=function(){this.setPath(),this.updatePathCommands()},Shape.prototype.setPath=function(){},Shape.prototype.updatePathCommands=function(){var previousPoint;this.pathCommands=this.path.map((function(pathPart,i){var keys=Object.keys(pathPart),method=keys[0],points=pathPart[method],isInstruction;1==keys.length&&-1!=actionNames.indexOf(method)||(method="line",points=pathPart);var isLineOrMove="line"==method||"move"==method,isPointsArray=Array.isArray(points);isLineOrMove&&!isPointsArray&&(points=[points]);var command=new PathCommand(method=0===i?"move":method,points,previousPoint);return previousPoint=command.endRenderPoint,command}))},Shape.prototype.reset=function(){this.renderOrigin.set(this.origin),this.renderFront.set(this.front),this.pathCommands.forEach((function(command){command.reset()}))},Shape.prototype.transform=function(translation,rotation,scale){this.renderOrigin.transform(translation,rotation,scale),this.renderFront.transform(translation,rotation,scale),this.renderNormal.set(this.renderOrigin).subtract(this.renderFront),this.pathCommands.forEach((function(command){command.transform(translation,rotation,scale)})),this.children.forEach((function(child){child.transform(translation,rotation,scale)}))},Shape.prototype.updateSortValue=function(){var pointCount=this.pathCommands.length,firstPoint=this.pathCommands[0].endRenderPoint,lastPoint=this.pathCommands[pointCount-1].endRenderPoint,isSelfClosing;pointCount>2&&firstPoint.isSame(lastPoint)&&(pointCount-=1);for(var sortValueTotal=0,i=0;i<pointCount;i++)sortValueTotal+=this.pathCommands[i].endRenderPoint.z;this.sortValue=sortValueTotal/pointCount},Shape.prototype.render=function(ctx,renderer){var length=this.pathCommands.length;if(this.visible&&length&&(this.isFacingBack=this.renderNormal.z>0,this.backface||!this.isFacingBack)){if(!renderer)throw new Error("Zdog renderer required. Set to "+renderer);var isDot=1==length;renderer.isCanvas&&isDot?this.renderCanvasDot(ctx,renderer):this.renderPath(ctx,renderer)}};var TAU=utils.TAU;Shape.prototype.renderCanvasDot=function(ctx){var lineWidth=this.getLineWidth();if(lineWidth){ctx.fillStyle=this.getRenderColor();var point=this.pathCommands[0].endRenderPoint;ctx.beginPath();var radius=lineWidth/2;ctx.arc(point.x,point.y,radius,0,TAU),ctx.fill()}},Shape.prototype.getLineWidth=function(){return this.stroke?1==this.stroke?1:this.stroke:0},Shape.prototype.getRenderColor=function(){var isBackfaceColor,color;return"string"==typeof this.backface&&this.isFacingBack?this.backface:this.color},Shape.prototype.renderPath=function(ctx,renderer){var elem=this.getRenderElement(ctx,renderer),isTwoPoints,isClosed=!(2==this.pathCommands.length&&"line"==this.pathCommands[1].method)&&this.closed,color=this.getRenderColor();renderer.renderPath(ctx,elem,this.pathCommands,isClosed),renderer.stroke(ctx,elem,this.stroke,color,this.getLineWidth()),renderer.fill(ctx,elem,this.fill,color),renderer.end(ctx,elem)};var svgURI="http://www.w3.org/2000/svg";return Shape.prototype.getRenderElement=function(ctx,renderer){if(renderer.isSvg)return this.svgElement||(this.svgElement=document.createElementNS(svgURI,"path"),this.svgElement.setAttribute("stroke-linecap","round"),this.svgElement.setAttribute("stroke-linejoin","round")),this.svgElement},Shape})),function(root,factory){if("object"==typeof module&&module.exports)module.exports=factory(require("./anchor"));else{var Zdog=root.Zdog;Zdog.Group=factory(Zdog.Anchor)}}(this,(function factory(Anchor){var Group=Anchor.subclass({updateSort:!1,visible:!0});return Group.prototype.updateSortValue=function(){var sortValueTotal=0;this.flatGraph.forEach((function(item){item.updateSortValue(),sortValueTotal+=item.sortValue})),this.sortValue=sortValueTotal/this.flatGraph.length,this.updateSort&&this.flatGraph.sort(Anchor.shapeSorter)},Group.prototype.render=function(ctx,renderer){this.visible&&this.flatGraph.forEach((function(item){item.render(ctx,renderer)}))},Group.prototype.updateFlatGraph=function(){var flatGraph=[];this.flatGraph=this.addChildFlatGraph(flatGraph)},Group.prototype.getFlatGraph=function(){return[this]},Group})),function(root,factory){if("object"==typeof module&&module.exports)module.exports=factory(require("./shape"));else{var Zdog=root.Zdog;Zdog.Rect=factory(Zdog.Shape)}}(this,(function factory(Shape){var Rect=Shape.subclass({width:1,height:1});return Rect.prototype.setPath=function(){var x=this.width/2,y=this.height/2;this.path=[{x:-x,y:-y},{x:x,y:-y},{x:x,y:y},{x:-x,y:y}]},Rect})),function(root,factory){if("object"==typeof module&&module.exports)module.exports=factory(require("./shape"));else{var Zdog=root.Zdog;Zdog.RoundedRect=factory(Zdog.Shape)}}(this,(function factory(Shape){var RoundedRect=Shape.subclass({width:1,height:1,cornerRadius:.25,closed:!1});return RoundedRect.prototype.setPath=function(){var xA=this.width/2,yA=this.height/2,shortSide=Math.min(xA,yA),cornerRadius=Math.min(this.cornerRadius,shortSide),xB=xA-cornerRadius,yB=yA-cornerRadius,path=[{x:xB,y:-yA},{arc:[{x:xA,y:-yA},{x:xA,y:-yB}]}];yB&&path.push({x:xA,y:yB}),path.push({arc:[{x:xA,y:yA},{x:xB,y:yA}]}),xB&&path.push({x:-xB,y:yA}),path.push({arc:[{x:-xA,y:yA},{x:-xA,y:yB}]}),yB&&path.push({x:-xA,y:-yB}),path.push({arc:[{x:-xA,y:-yA},{x:-xB,y:-yA}]}),xB&&path.push({x:xB,y:-yA}),this.path=path},RoundedRect})),function(root,factory){if("object"==typeof module&&module.exports)module.exports=factory(require("./shape"));else{var Zdog=root.Zdog;Zdog.Ellipse=factory(Zdog.Shape)}}(this,(function factory(Shape){var Ellipse=Shape.subclass({diameter:1,width:void 0,height:void 0,quarters:4,closed:!1});return Ellipse.prototype.setPath=function(){var width,height,x=(null!=this.width?this.width:this.diameter)/2,y=(null!=this.height?this.height:this.diameter)/2;this.path=[{x:0,y:-y},{arc:[{x:x,y:-y},{x:x,y:0}]}],this.quarters>1&&this.path.push({arc:[{x:x,y:y},{x:0,y:y}]}),this.quarters>2&&this.path.push({arc:[{x:-x,y:y},{x:-x,y:0}]}),this.quarters>3&&this.path.push({arc:[{x:-x,y:-y},{x:0,y:-y}]})},Ellipse})),function(root,factory){if("object"==typeof module&&module.exports)module.exports=factory(require("./boilerplate"),require("./shape"));else{var Zdog=root.Zdog;Zdog.Polygon=factory(Zdog,Zdog.Shape)}}(this,(function factory(utils,Shape){var Polygon=Shape.subclass({sides:3,radius:.5}),TAU=utils.TAU;return Polygon.prototype.setPath=function(){this.path=[];for(var i=0;i<this.sides;i++){var theta=i/this.sides*TAU-TAU/4,x=Math.cos(theta)*this.radius,y=Math.sin(theta)*this.radius;this.path.push({x:x,y:y})}},Polygon})),function(root,factory){if("object"==typeof module&&module.exports)module.exports=factory(require("./boilerplate"),require("./vector"),require("./anchor"),require("./ellipse"));else{var Zdog=root.Zdog;Zdog.Hemisphere=factory(Zdog,Zdog.Vector,Zdog.Anchor,Zdog.Ellipse)}}(this,(function factory(utils,Vector,Anchor,Ellipse){var Hemisphere=Ellipse.subclass({fill:!0}),TAU=utils.TAU;Hemisphere.prototype.create=function(){Ellipse.prototype.create.apply(this,arguments),this.apex=new Anchor({addTo:this,translate:{z:this.diameter/2}}),this.renderCentroid=new Vector},Hemisphere.prototype.updateSortValue=function(){this.renderCentroid.set(this.renderOrigin).lerp(this.apex.renderOrigin,3/8),this.sortValue=this.renderCentroid.z},Hemisphere.prototype.render=function(ctx,renderer){this.renderDome(ctx,renderer),Ellipse.prototype.render.apply(this,arguments)},Hemisphere.prototype.renderDome=function(ctx,renderer){if(this.visible){var elem=this.getDomeRenderElement(ctx,renderer),contourAngle=Math.atan2(this.renderNormal.y,this.renderNormal.x),domeRadius=this.diameter/2*this.renderNormal.magnitude(),x=this.renderOrigin.x,y=this.renderOrigin.y;if(renderer.isCanvas){var startAngle=contourAngle+TAU/4,endAngle=contourAngle-TAU/4;ctx.beginPath(),ctx.arc(x,y,domeRadius,startAngle,endAngle)}else renderer.isSvg&&(contourAngle=(contourAngle-TAU/4)/TAU*360,this.domeSvgElement.setAttribute("d","M "+-domeRadius+",0 A "+domeRadius+","+domeRadius+" 0 0 1 "+domeRadius+",0"),this.domeSvgElement.setAttribute("transform","translate("+x+","+y+" ) rotate("+contourAngle+")"));renderer.stroke(ctx,elem,this.stroke,this.color,this.getLineWidth()),renderer.fill(ctx,elem,this.fill,this.color),renderer.end(ctx,elem)}};var svgURI="http://www.w3.org/2000/svg";return Hemisphere.prototype.getDomeRenderElement=function(ctx,renderer){if(renderer.isSvg)return this.domeSvgElement||(this.domeSvgElement=document.createElementNS(svgURI,"path"),this.domeSvgElement.setAttribute("stroke-linecap","round"),this.domeSvgElement.setAttribute("stroke-linejoin","round")),this.domeSvgElement},Hemisphere})),function(root,factory){if("object"==typeof module&&module.exports)module.exports=factory(require("./boilerplate"),require("./path-command"),require("./shape"),require("./group"),require("./ellipse"));else{var Zdog=root.Zdog;Zdog.Cylinder=factory(Zdog,Zdog.PathCommand,Zdog.Shape,Zdog.Group,Zdog.Ellipse)}}(this,(function factory(utils,PathCommand,Shape,Group,Ellipse){function noop(){}var CylinderGroup=Group.subclass({color:"#333",updateSort:!0});CylinderGroup.prototype.create=function(){Group.prototype.create.apply(this,arguments),this.pathCommands=[new PathCommand("move",[{}]),new PathCommand("line",[{}])]},CylinderGroup.prototype.render=function(ctx,renderer){this.renderCylinderSurface(ctx,renderer),Group.prototype.render.apply(this,arguments)},CylinderGroup.prototype.renderCylinderSurface=function(ctx,renderer){if(this.visible){var elem=this.getRenderElement(ctx,renderer),frontBase=this.frontBase,rearBase=this.rearBase,scale=frontBase.renderNormal.magnitude(),strokeWidth=frontBase.diameter*scale+frontBase.getLineWidth();this.pathCommands[0].renderPoints[0].set(frontBase.renderOrigin),this.pathCommands[1].renderPoints[0].set(rearBase.renderOrigin),renderer.isCanvas&&(ctx.lineCap="butt"),renderer.renderPath(ctx,elem,this.pathCommands),renderer.stroke(ctx,elem,!0,this.color,strokeWidth),renderer.end(ctx,elem),renderer.isCanvas&&(ctx.lineCap="round")}};var svgURI="http://www.w3.org/2000/svg",CylinderEllipse;CylinderGroup.prototype.getRenderElement=function(ctx,renderer){if(renderer.isSvg)return this.svgElement||(this.svgElement=document.createElementNS(svgURI,"path")),this.svgElement},CylinderGroup.prototype.copyGraph=noop,Ellipse.subclass().prototype.copyGraph=noop;var Cylinder=Shape.subclass({diameter:1,length:1,frontFace:void 0,fill:!0}),TAU=utils.TAU,childProperties;return Cylinder.prototype.create=function(){Shape.prototype.create.apply(this,arguments),this.group=new CylinderGroup({addTo:this,color:this.color,visible:this.visible});var baseZ=this.length/2,baseColor=this.backface||!0;this.frontBase=this.group.frontBase=new Ellipse({addTo:this.group,diameter:this.diameter,translate:{z:baseZ},rotate:{y:TAU/2},color:this.color,stroke:this.stroke,fill:this.fill,backface:this.frontFace||baseColor,visible:this.visible}),this.rearBase=this.group.rearBase=this.frontBase.copy({translate:{z:-baseZ},rotate:{y:0},backface:baseColor})},Cylinder.prototype.render=function(){},["stroke","fill","color","visible"].forEach((function(property){var _prop="_"+property;Object.defineProperty(Cylinder.prototype,property,{get:function(){return this[_prop]},set:function(value){this[_prop]=value,this.frontBase&&(this.frontBase[property]=value,this.rearBase[property]=value,this.group[property]=value)}})})),Cylinder})),function(root,factory){if("object"==typeof module&&module.exports)module.exports=factory(require("./boilerplate"),require("./vector"),require("./path-command"),require("./anchor"),require("./ellipse"));else{var Zdog=root.Zdog;Zdog.Cone=factory(Zdog,Zdog.Vector,Zdog.PathCommand,Zdog.Anchor,Zdog.Ellipse)}}(this,(function factory(utils,Vector,PathCommand,Anchor,Ellipse){var Cone=Ellipse.subclass({length:1,fill:!0}),TAU=utils.TAU;Cone.prototype.create=function(){Ellipse.prototype.create.apply(this,arguments),this.apex=new Anchor({addTo:this,translate:{z:this.length}}),this.renderApex=new Vector,this.renderCentroid=new Vector,this.tangentA=new Vector,this.tangentB=new Vector,this.surfacePathCommands=[new PathCommand("move",[{}]),new PathCommand("line",[{}]),new PathCommand("line",[{}])]},Cone.prototype.updateSortValue=function(){this.renderCentroid.set(this.renderOrigin).lerp(this.apex.renderOrigin,1/3),this.sortValue=this.renderCentroid.z},Cone.prototype.render=function(ctx,renderer){this.renderConeSurface(ctx,renderer),Ellipse.prototype.render.apply(this,arguments)},Cone.prototype.renderConeSurface=function(ctx,renderer){if(this.visible){this.renderApex.set(this.apex.renderOrigin).subtract(this.renderOrigin);var scale=this.renderNormal.magnitude(),apexDistance=this.renderApex.magnitude2d(),normalDistance=this.renderNormal.magnitude2d(),eccenAngle=Math.acos(normalDistance/scale),eccen=Math.sin(eccenAngle),radius=this.diameter/2*scale,isApexVisible;if(radius*eccen<apexDistance){var apexAngle=Math.atan2(this.renderNormal.y,this.renderNormal.x)+TAU/2,projectLength=apexDistance/eccen,projectAngle=Math.acos(radius/projectLength),tangentA=this.tangentA,tangentB=this.tangentB;tangentA.x=Math.cos(projectAngle)*radius*eccen,tangentA.y=Math.sin(projectAngle)*radius,tangentB.set(this.tangentA),tangentB.y*=-1,tangentA.rotateZ(apexAngle),tangentB.rotateZ(apexAngle),tangentA.add(this.renderOrigin),tangentB.add(this.renderOrigin),this.setSurfaceRenderPoint(0,tangentA),this.setSurfaceRenderPoint(1,this.apex.renderOrigin),this.setSurfaceRenderPoint(2,tangentB);var elem=this.getSurfaceRenderElement(ctx,renderer);renderer.renderPath(ctx,elem,this.surfacePathCommands),renderer.stroke(ctx,elem,this.stroke,this.color,this.getLineWidth()),renderer.fill(ctx,elem,this.fill,this.color),renderer.end(ctx,elem)}}};var svgURI="http://www.w3.org/2000/svg";return Cone.prototype.getSurfaceRenderElement=function(ctx,renderer){if(renderer.isSvg)return this.surfaceSvgElement||(this.surfaceSvgElement=document.createElementNS(svgURI,"path"),this.surfaceSvgElement.setAttribute("stroke-linecap","round"),this.surfaceSvgElement.setAttribute("stroke-linejoin","round")),this.surfaceSvgElement},Cone.prototype.setSurfaceRenderPoint=function(index,point){var renderPoint;this.surfacePathCommands[index].renderPoints[0].set(point)},Cone})),function(root,factory){if("object"==typeof module&&module.exports)module.exports=factory(require("./boilerplate"),require("./anchor"),require("./shape"),require("./rect"));else{var Zdog=root.Zdog;Zdog.Box=factory(Zdog,Zdog.Anchor,Zdog.Shape,Zdog.Rect)}}(this,(function factory(utils,Anchor,Shape,Rect){var BoxRect=Rect.subclass();BoxRect.prototype.copyGraph=function(){};var TAU=utils.TAU,faceNames=["frontFace","rearFace","leftFace","rightFace","topFace","bottomFace"],boxDefaults=utils.extend({},Shape.defaults);delete boxDefaults.path,faceNames.forEach((function(faceName){boxDefaults[faceName]=!0})),utils.extend(boxDefaults,{width:1,height:1,depth:1,fill:!0});var Box=Anchor.subclass(boxDefaults),childProperties;return Box.prototype.create=function(options){Anchor.prototype.create.call(this,options),this.updatePath(),this.fill=this.fill},Box.prototype.updatePath=function(){faceNames.forEach((function(faceName){this[faceName]=this[faceName]}),this)},faceNames.forEach((function(faceName){var _faceName="_"+faceName;Object.defineProperty(Box.prototype,faceName,{get:function(){return this[_faceName]},set:function(value){this[_faceName]=value,this.setFace(faceName,value)}})})),Box.prototype.setFace=function(faceName,value){var rectProperty=faceName+"Rect",rect=this[rectProperty];if(value){var options=this.getFaceOptions(faceName);options.color="string"==typeof value?value:this.color,rect?rect.setOptions(options):rect=this[rectProperty]=new BoxRect(options),rect.updatePath(),this.addChild(rect)}else this.removeChild(rect)},Box.prototype.getFaceOptions=function(faceName){return{frontFace:{width:this.width,height:this.height,translate:{z:this.depth/2}},rearFace:{width:this.width,height:this.height,translate:{z:-this.depth/2},rotate:{y:TAU/2}},leftFace:{width:this.depth,height:this.height,translate:{x:-this.width/2},rotate:{y:-TAU/4}},rightFace:{width:this.depth,height:this.height,translate:{x:this.width/2},rotate:{y:TAU/4}},topFace:{width:this.width,height:this.depth,translate:{y:-this.height/2},rotate:{x:-TAU/4}},bottomFace:{width:this.width,height:this.depth,translate:{y:this.height/2},rotate:{x:TAU/4}}}[faceName]},["color","stroke","fill","backface","front","visible"].forEach((function(property){var _prop="_"+property;Object.defineProperty(Box.prototype,property,{get:function(){return this[_prop]},set:function(value){this[_prop]=value,faceNames.forEach((function(faceName){var rect=this[faceName+"Rect"],isFaceColor="string"==typeof this[faceName],isColorUnderwrite;rect&&!("color"==property&&isFaceColor)&&(rect[property]=value)}),this)}})})),Box})),function(root,factory){"object"==typeof module&&module.exports?module.exports=factory(require("./boilerplate"),require("./canvas-renderer"),require("./svg-renderer"),require("./vector"),require("./anchor"),require("./dragger"),require("./illustration"),require("./path-command"),require("./shape"),require("./group"),require("./rect"),require("./rounded-rect"),require("./ellipse"),require("./polygon"),require("./hemisphere"),require("./cylinder"),require("./cone"),require("./box")):"function"==typeof define&&define.amd&&define("zdog",[],root.Zdog)}(this,(function factory(Zdog,CanvasRenderer,SvgRenderer,Vector,Anchor,Dragger,Illustration,PathCommand,Shape,Group,Rect,RoundedRect,Ellipse,Polygon,Hemisphere,Cylinder,Cone,Box){return Zdog.CanvasRenderer=CanvasRenderer,Zdog.SvgRenderer=SvgRenderer,Zdog.Vector=Vector,Zdog.Anchor=Anchor,Zdog.Dragger=Dragger,Zdog.Illustration=Illustration,Zdog.PathCommand=PathCommand,Zdog.Shape=Shape,Zdog.Group=Group,Zdog.Rect=Rect,Zdog.RoundedRect=RoundedRect,Zdog.Ellipse=Ellipse,Zdog.Polygon=Polygon,Zdog.Hemisphere=Hemisphere,Zdog.Cylinder=Cylinder,Zdog.Cone=Cone,Zdog.Box=Box,Zdog}));